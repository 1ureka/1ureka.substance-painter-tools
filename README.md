# Substance Painter Tools

一個專為 Substance Painter 10.0.1 設計的 Python 擴展，提供強大的**映射變換**功能與便捷的**隨機化**工具，讓材質編輯工作流程更加高效。

# 核心功能

## 映射變換 (Transform)

**映射變換是本擴展的核心功能**，允許你批次調整圖層的縮放和旋轉參數，大幅提升紋理編輯效率。

- **批次處理**: 一次性處理多個紋理集的所有圖層
- **智慧識別**: 自動識別並處理不同類型的圖層
- **精確控制**: 支援自訂縮放倍數和旋轉角度
- **圖層過濾**: 自動排除不應處理的特殊圖層 (錨點、烘焙結果等)
- **詳細報告**: 執行後提供樹狀結構的結果檢視，清楚顯示每個圖層的處理狀態

| 圖層類型                   | 影響參數             | 參數說明                                                                                                | 範例                                                                                  |
| -------------------------- | -------------------- | ------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| **使用 3D 紋理的填充圖層** | 第一個匹配的縮放參數 | 一個 3D 程序紋理來源只會有一個紋理，因此只匹配第一個找到的縮放相關參數，避免重複縮放。                  | 3D Perlin Noise、3D Worley Noise、3D Voronoi 等                                       |
| **普通填充圖層**           | UV 或三角映射參數    | 普通填充圖層使用 UV 或 Triplanar 映射，會調整 UV 變換參數，包括**縮放** (scale) 和**旋轉** (rotation)。 | 圖像紋理填充圖層、Material 填充圖層、Base Color 使用圖像、Height 使用純色的混和圖層等 |
| **生成器圖層**             | 所有匹配到的縮放參數 | 生成器通常會引用多個紋理，因此會匹配**所有包含 `scale` 字樣的參數**並調整它們。                         | Mask Builder、Mask Editor、Metal Edge Wear 等                                         |

## 隨機化 (Randomize)

**隨機化功能是輔助功能**，用於快速為專案中所有支援的 Substance 紋理設定新的隨機種子，產生不同的視覺變化。

| 影響目標                | 說明                                                                                                                                                                               | 範例                                                                               |
| ----------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------- |
| **任意 Substance 來源** | 指 Substance Designer 生成的程序紋理資源 (`.sbsar` 檔案)。隨機化功能會自動掃描專案中所有圖層使用的 Substance 來源，為其 `$randomseed` 參數設定新的隨機種子值，產生不同的視覺效果。 | Material、Dirt、Scratches、帶有隨機性的效果或生成器、生成器引用的 Custom Grunge 等 |

# 安裝指南

## 系統需求

- **Substance Painter**: 10.0.1
- **Python**: 3.6 或更高版本 (用於執行建置腳本 `build.py`)

## 安裝步驟

1. 將專案下載或克隆到本地:

   ```bash
   git clone https://github.com/1ureka/1ureka.substance-painter-tools.git
   cd 1ureka.substance-painter-tools
   ```

2. 找到 Substance Painter 擴展目錄:

   - **Windows**: `C:\Users\<使用者名稱>\Documents\Adobe\Adobe Substance 3D Painter\python\plugins`
   - **macOS**: `~/Documents/Adobe/Adobe Substance 3D Painter/python/plugins`
   - **Linux**: `~/.config/Adobe/Adobe Substance 3D Painter/python/plugins`

3. 修改 [build.py](build.py) 中的 `target_base` 變數:

   ```python
   # 將以下路徑修改為你的 Substance Painter 擴展目錄
   target_base = Path("C:\\Users\\你的使用者名稱\\Documents\\Adobe\\Adobe Substance 3D Painter\\python\\plugins")
   ```

4. 執行建置腳本:

   ```bash
   python build.py
   ```

5. 建置腳本會自動:
   - 複製所有 `.py` 檔案到 Substance Painter 擴展目錄
   - 維持原有的目錄結構
   - 建立 `1ureka_tools` 擴展資料夾

## 模組熱重載

若有修改程式碼的需求，本擴展原生支援熱重載機制，修改程式碼後無需重新啟動 Substance Painter:

1. 使用 IDE 開啟擴展安裝目錄
2. 直接修改程式碼並儲存
3. 在 Substance Painter 中執行「Python」→「重新載入所有插件」

# 使用方法

## 開啟擴展選單

有兩種方式可以開啟擴展選單:

1. **快捷鍵**: 按下 `Ctrl+Q` (Windows/Linux) 或 `Cmd+Q` (macOS)
2. **選單**: 點擊 Substance Painter 頂部選單列的「編輯 (Edit)」→「開啟擴展選單」

開啟後會在滑鼠游標位置顯示一個**環形選單 (Radial Menu)**，包含兩個選項:

- **映射變換**
- **隨機化種子**

## 使用映射變換

1. **開啟專案**: 確保你已在 Substance Painter 中開啟一個專案

2. **開啟擴展選單**: 按 `Ctrl+Q` 並選擇「映射變換」

3. **設定參數**:

   - **縮放倍數**: 輸入縮放比例 (0.01 ~ 100.0) ，例如:
     - `2.0`: 將紋理放大 2 倍
     - `0.5`: 將紋理縮小為原本的 50%
   - **旋轉度數**: 輸入旋轉角度 (-180° ~ 180°) ，例如:
     - `90`: 順時針旋轉 90 度
     - `-45`: 逆時針旋轉 45 度
   - 提供快速選取按鈕方便設定常用值 (如 0.5、1.0、2.0)

4. **選擇紋理集**:

   - 勾選要處理的紋理集 (預設會選中當前活動的紋理集)
   - 可使用「全選」/「全不選」按鈕快速選擇
   - 支援一次處理多個紋理集

5. **套用變換**: 點擊「套用所選變換」按鈕

6. **檢視結果**:
   - 自動開啟結果檢視對話框，以樹狀結構顯示每個圖層的處理狀態
   - 樹狀結構可以互動，比如展開/收合節點
   - 可使用篩選選項查看成功或失敗的項目
   - 可輸出成 Markdown 格式的執行日誌

## 使用隨機化種子

1. **開啟專案**: 確保你已在 Substance Painter 中開啟一個專案

2. **開啟擴展選單**: 按 `Ctrl+Q` 並選擇「隨機化種子」

3. **自動執行**: 其功能較為單一，因此沒有特殊的 UI，選擇後會立刻執行並只在日誌中輸出結果

## 撤銷與重做

所有操作都使用 Substance Painter 的 `ScopedModification` 機制，確保:

- 整個批次操作可以作為單一步驟撤銷 (`Ctrl+Z`)
- 撤銷後可以重做 (`Ctrl+Y`)

# 常見問題 (FAQ)

## Q: 為什麼有些圖層被跳過？

A: 擴展會自動排除以下圖層，以確保專案安全性並避免破壞特殊邏輯：

- **錨點圖層 (Anchors)**：因其引用自其他圖層，不應直接修改。
- **專案資源 (Baked Maps)**：避免誤動到烘焙好的法線或遮蔽圖。
- **不可見的群組**：方便使用者透過隱藏來排除不想處理的內容。
- **非 UV/Triplanar 映射的圖層**：避免對座標系統不相符的內容進行錯誤縮放。

## Q: 可以只處理選定的圖層嗎？

A: 目前版本以**紋理集 (Texture Set)** 為最小單位。如果你只想處理特定圖層，建議：

1. 將目標圖層放入一個**群組**。
2. **隱藏**其他不需處理的圖層或群組（隱藏狀態會被擴展自動跳過）。
3. 執行映射變換後再重新顯示。

## Q: 旋轉對 3D 程序紋理有效嗎？

A: **不支援，但僅限於純 3D 空間採樣的雜訊。**
雖然 Blender 等軟體中的 3D 紋理（如 Wave）具方向性，但 Substance Painter 內建的 3D 紋理（如 3D Perlin/Worley Noise）屬於**無方向性的體積雜訊**，在技術上不具備旋轉座標軸的概念。因此，擴展對此類圖層僅會調整**縮放 (Scale)** 參數。

> [!TIP]
>
> **關於具備方向性的程序紋理：**
> Substance Painter 中許多看似有方向性的紋理（如 **Scratches (抓痕)**、**Wood (木紋)**）實際上是 **2D 程序紋理**。本擴展會自動將其識別為普通填充圖層，並**完整支援旋轉與縮放功能**。
